<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="test_detectCOs_polyrec_functions.py" href="test_detectCOs_polyrec_functions.html" /><link rel="prev" title="detectCOs_sliding_window.py" href="detectCOs_sliding_window.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>detectCOs_identifyCOs.py - detectCOs 2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">detectCOs 2.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">detectCOs 2.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_detectCOs_CG.html">config_detectCOs_CG.yaml</a></li>
<li class="toctree-l1"><a class="reference internal" href="detectCOs_required_functions.html">detectCOs_required_functions.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="detectCOs_read_files.html">detectCOs_read_files.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="detectCOs_sliding_window.html">detectCOs_sliding_window.py</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">detectCOs_identifyCOs.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_detectCOs_polyrec_functions.html">test_detectCOs_polyrec_functions.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="Test_yaml_detectCOs_BC.html">Test_yaml_detectCOs_BC.yaml</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="detectcos-identifycos-py">
<h1>detectCOs_identifyCOs.py<a class="headerlink" href="#detectcos-identifycos-py" title="Link to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hues</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">detectCOs_required_functions</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<section id="function-identifycos">
<h2>Function : IdentifyCOs<a class="headerlink" href="#function-identifycos" title="Link to this heading">#</a></h2>
<p><strong>Code :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">IdentifyCOs</span><span class="p">(</span><span class="n">offspring_genotype_window_smoothed</span><span class="p">,</span> <span class="n">nb_windows_chr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description:    Find location of hypothetical cross-over according to the change of genotype</span>

<span class="sd">    Input:                  - offspring_genotype_window_smoothed: Ordered dictionnary</span>
<span class="sd">                    from SmoothNormalizedOsffspringSlidingWindow containing :</span>
<span class="sd">                    [chr_window] = [start, stop, ADref/DP, ADalt/DP, probHomoRef, probHetero, probHomoAlt, genotype]</span>

<span class="sd">                    - nb_windows_chr:       number of window per chromosome, determine with function</span>
<span class="sd">                    NormalizeOffspringSlidingWindow()</span>

<span class="sd">    Output:                 Cross-over candidate from smoothed windows</span>
<span class="sd">                    candidates_co[chr_mean_window] = [left_window_border + &quot;:&quot; + right_window_border,</span>
<span class="sd">                                                    co pos start, co pos stop, previous genotype, new genotype]</span>

<span class="sd">                    All double cross-over found during the analysis are saved, even if they are under the threshold</span>
<span class="sd">                    to support the genotype (thr_support) :</span>
<span class="sd">                    db_co[chr_mean_window] = [cur_chr, start_co_win:stop_co_win, previous genotype, new genotype, status]</span>

<span class="sd">    Upgrade? :      add input parameter : length required to support genotype (kb, default 300kb) and window size (kb)</span>
<span class="sd">                modify :</span>
<span class="sd">                    if stop_win &lt;= 10 or start_win &gt; (nb_win - 10):</span>
<span class="sd">                        thr_support = int((thr_support_kb/window_size) - 1) # (thr_support_kb/2)/(window_size/2) - 1</span>
<span class="sd">                    else:</span>
<span class="sd">                        thr_support = int((thr_support_kb/(window_size/2)) - 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Identify candidate crossovers&quot;</span><span class="p">)</span>

    <span class="n">candidates_co</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">db_co</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="c1"># save all homo to another homo genotype even if they are not enough supported</span>
    <span class="n">thr_support</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span> <span class="c1"># number of windows to support genotype = threshold support</span>

    <span class="k">for</span> <span class="n">cur_chr</span><span class="p">,</span> <span class="n">nb_win</span> <span class="ow">in</span> <span class="n">nb_windows_chr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1">## iteration on each chromosome</span>
        <span class="n">nb_win</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nb_win</span><span class="p">)</span>

        <span class="c1"># information about the window num_win</span>
        <span class="n">cur_support</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># number of window that support current genotype</span>
        <span class="n">cur_geno</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span> <span class="c1"># genotype of current window(=geno_stop)</span>
        <span class="n">cur_win</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span> <span class="c1"># current window = num_win + 1</span>

        <span class="c1"># information about the previous supported geonotype</span>
        <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># genotype of the window before the hypothetical COs</span>
        <span class="n">pre_win</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span> <span class="c1"># last window of the previous genotype (before hypothetical COs)</span>

        <span class="c1"># count between previous genotype and current genotype</span>
        <span class="n">count_NA</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of consecutive NA window</span>
        <span class="n">support_preNA</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># support of genotype before starting NA region</span>


        <span class="k">for</span> <span class="n">num_win</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_win</span><span class="p">):</span> <span class="c1"># iteration on the each window of each chromosome cur_chr</span>

            <span class="c1"># Define genotype for window start and stop</span>
            <span class="n">start_win</span> <span class="o">=</span> <span class="n">num_win</span> <span class="c1"># from 1 to the penultimate num_win (due to range function)</span>
            <span class="n">key_start</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_win</span><span class="p">)</span>
            <span class="n">geno_start</span> <span class="o">=</span> <span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">key_start</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>

            <span class="n">stop_win</span> <span class="o">=</span> <span class="n">num_win</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># from 2 to the last num_win</span>
            <span class="n">key_stop</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_win</span><span class="p">)</span>
            <span class="n">geno_stop</span> <span class="o">=</span> <span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">key_stop</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>

            <span class="c1">## Edit the thr_support = min number of window to validate a COs</span>
            <span class="k">if</span> <span class="n">stop_win</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">start_win</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">nb_win</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span>
                <span class="c1"># for both ends of chromosomes (9 first and 9 last slides)</span>
                <span class="n">thr_support</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># for all other windows</span>
                <span class="n">thr_support</span> <span class="o">=</span> <span class="mi">5</span>

            <span class="c1">## Initialization of the start and stop posistion of the CO</span>
            <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span> <span class="c1"># mean position of the start window of the crossover</span>
            <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span> <span class="c1"># mean position of the stop window of the crossover</span>
            <span class="n">stop_co_win</span> <span class="o">=</span> <span class="nb">int</span><span class="p">()</span> <span class="c1"># number of window of the end of the crossover region</span>


            <span class="k">if</span> <span class="n">geno_start</span> <span class="o">!=</span> <span class="n">geno_stop</span> <span class="p">:</span>

                <span class="k">if</span> <span class="n">geno_start</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">or</span> <span class="n">geno_stop</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">geno_start</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">geno_stop</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="p">:</span>
                        <span class="c1"># when enter in NA region:</span>
                        <span class="n">geno_preNA</span> <span class="o">=</span> <span class="n">geno_start</span>
                        <span class="n">win_preNA</span> <span class="o">=</span> <span class="n">start_win</span>
                        <span class="n">count_NA</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">support_preNA</span> <span class="o">=</span> <span class="n">cur_support</span>
                        <span class="k">continue</span>

                    <span class="k">elif</span> <span class="n">geno_start</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">geno_stop</span> <span class="o">==</span> <span class="n">geno_preNA</span> <span class="p">:</span>
                        <span class="n">cur_support</span> <span class="o">+=</span><span class="mi">1</span>

                        <span class="k">if</span> <span class="n">support_preNA</span> <span class="o">&gt;=</span> <span class="n">thr_support</span> <span class="ow">and</span> <span class="n">pre_geno</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="c1">## voir cas 13</span>
                            <span class="n">cur_win</span> <span class="o">=</span> <span class="n">stop_win</span>
                            <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">geno_stop</span>
                            <span class="n">stop_co_win</span> <span class="o">=</span> <span class="n">cur_win</span> <span class="o">-</span> <span class="n">cur_support</span> <span class="o">-</span> <span class="n">count_NA</span> <span class="o">+</span> <span class="mi">1</span>

                            <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                            <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                            <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_win</span> <span class="o">+</span> <span class="n">stop_co_win</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                            <span class="n">candidates_co</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">),</span> <span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

                            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">)</span> <span class="p">:</span>
                                <span class="n">db_co</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur_chr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">),</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">,</span> <span class="s2">&quot;supported&quot;</span><span class="p">]</span>

                        <span class="k">continue</span>

                    <span class="k">elif</span> <span class="n">geno_start</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">geno_stop</span> <span class="o">!=</span> <span class="n">geno_preNA</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cur_support</span> <span class="o">&gt;=</span> <span class="n">thr_support</span><span class="p">:</span>
                            <span class="c1"># if geno_stop != geno_preNA, edit pre_geno and pre_win with the information before NA region</span>
                            <span class="n">pre_geno</span> <span class="o">=</span> <span class="n">geno_preNA</span> <span class="c1"># genotype before NA region</span>
                            <span class="n">pre_win</span> <span class="o">=</span> <span class="n">win_preNA</span> <span class="c1"># last window before NA region</span>
                            <span class="n">geno_preNA</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="n">win_preNA</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">elif</span> <span class="n">cur_support</span> <span class="o">&gt;=</span> <span class="n">thr_support</span><span class="p">:</span>
                    <span class="c1"># if genotype change between start and stop num_win and</span>
                    <span class="c1"># genotype supported by at least threshold support (2 or 5)</span>
                    <span class="n">pre_geno</span> <span class="o">=</span> <span class="n">geno_start</span> <span class="c1"># genotype of window before CO</span>
                    <span class="n">pre_win</span> <span class="o">=</span> <span class="n">start_win</span> <span class="c1"># window before CO</span>
                    <span class="c1"># pre_num = cur_support # useless</span>

                <span class="n">cur_support</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># reset cur_support</span>

                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">geno_start</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">geno_stop</span><span class="p">)</span> <span class="ow">and</span> <span class="n">geno_start</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">geno_stop</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                    <span class="n">key_db_co</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">start_win</span> <span class="o">+</span> <span class="n">stop_win</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">db_co</span><span class="p">[</span><span class="n">key_db_co</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur_chr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_win</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_win</span><span class="p">),</span> <span class="n">geno_start</span><span class="p">,</span> <span class="n">geno_stop</span><span class="p">,</span> <span class="s2">&quot;not_supported&quot;</span><span class="p">]</span>


            <span class="k">else</span><span class="p">:</span> <span class="c1"># geno_start == geno_stop</span>
                <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">geno_stop</span>
                <span class="n">cur_win</span> <span class="o">=</span> <span class="n">stop_win</span>

                <span class="k">if</span> <span class="n">cur_geno</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="p">:</span>
                    <span class="n">count_NA</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="n">cur_support</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">cur_geno</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">elif</span> <span class="n">pre_geno</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">cur_support</span> <span class="o">==</span> <span class="n">thr_support</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">support_preNA</span> <span class="o">&lt;</span> <span class="n">thr_support</span> <span class="ow">and</span> <span class="n">support_preNA</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">:</span>
                        <span class="c1"># if there is some NA window during the count of cur_support</span>
                        <span class="n">stop_co_win</span> <span class="o">=</span> <span class="n">cur_win</span> <span class="o">-</span> <span class="n">cur_support</span> <span class="o">-</span> <span class="n">count_NA</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">stop_co_win</span> <span class="o">=</span> <span class="n">cur_win</span> <span class="o">-</span> <span class="n">cur_support</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                    <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">offspring_genotype_window_smoothed</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                    <span class="c1">## Edit candidate</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_win</span> <span class="o">+</span> <span class="n">stop_co_win</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">candidates_co</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">),</span> <span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

                    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">db_co</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur_chr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_win</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop_co_win</span><span class="p">),</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">,</span> <span class="s2">&quot;supported&quot;</span><span class="p">]</span>

                    <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">count_NA</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">support_preNA</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">### Raise warning for all double COs found in the data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">db_co</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Be careful, some double COs has been found during the analysis :&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">db_co</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># value = [cur_chr, start_co_win:stop_co_win, previous genotype, new genotype, status]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot; (window &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;): &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> \
                <span class="s2">&quot; (&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">candidates_co</span><span class="p">,</span> <span class="n">db_co</span>
</pre></div>
</div>
<p><strong>Explication :</strong></p>
<p><cite>IdentifyCOs</cite> : Cette fonction cherche les emplacements des croisements hypothétiques (crossovers) en fonction du changement de génotype.</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Entrée:</dt><dd><ul>
<li><p><cite>offspring_genotype_window_smoothed</cite>: Un dictionnaire ordonné issu de la fonction <cite>SmoothNormalizedOsffspringSlidingWindow</cite> contenant les données de génotype des descendants.</p></li>
<li><p><cite>nb_windows_chr</cite>: Le nombre de fenêtres par chromosome, déterminé à l’aide de la fonction <cite>NormalizeOffspringSlidingWindow</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Sortie:</dt><dd><ul>
<li><p><cite>candidates_co</cite>: Candidats aux croisements, issus des fenêtres lissées.</p></li>
<li><p><cite>db_co</cite>: Tous les croisements doubles trouvés pendant l’analyse, même s’ils ne sont pas suffisamment pris en charge.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Fonctionnement :</dt><dd><ul>
<li><p>La fonction parcourt chaque chromosome et examine chaque fenêtre de données de génotype.</p></li>
<li><p>Elle détecte les changements de génotype entre les fenêtres et recherche les positions de début et de fin des croisements.</p></li>
<li><p>Les croisements sont enregistrés avec leurs positions moyennes et les génotypes avant et après le croisement.</p></li>
<li><p>Les croisements doubles sont également enregistrés, même s’ils ne sont pas suffisamment pris en charge.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>La fonction prend également en charge des paramètres pour ajuster le seuil de support nécessaire pour valider un croisement, ainsi que la taille requise pour supporter un génotype.</p>
</div></blockquote>
</section>
<section id="function-refinecoborders">
<h2>Function : RefineCOBorders<a class="headerlink" href="#function-refinecoborders" title="Link to this heading">#</a></h2>
<p><strong>Code :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">RefineCOBorders</span><span class="p">(</span><span class="n">CandidateCOs</span><span class="p">,</span> <span class="n">Offspring_infoSNPs</span><span class="p">,</span> <span class="n">window_size</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Refine crossover borders&quot;</span><span class="p">)</span>

    <span class="n">RefinedCOs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">co_key</span><span class="p">,</span> <span class="n">co_value</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">cur_chr</span><span class="p">,</span> <span class="n">cur_pos</span> <span class="o">=</span> <span class="n">co_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">win</span><span class="p">,</span> <span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">co_value</span>

        <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">):</span>

            <span class="n">cur_geno1</span><span class="p">,</span> <span class="n">cur_geno2</span> <span class="o">=</span> <span class="n">cur_geno</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno</span>
            <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">cur_geno1</span><span class="p">:</span>
                <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno1</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="n">pre_geno</span>

            <span class="n">refined_infosnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_infosnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">refined_infosnp_pos</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Offspring_infoSNPs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">snp_geno</span> <span class="o">=</span> <span class="n">Offspring_infoSNPs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pre_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">cur_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span>
            <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">refined_infosnp_cnt</span><span class="p">):</span>

                <span class="n">snp_pos</span><span class="p">,</span> <span class="n">snp_type</span> <span class="o">=</span> <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&gt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                    <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">snp_pos</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&lt;</span> <span class="n">refined_info_stop</span><span class="p">:</span>
                    <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">snp_pos</span>
                    <span class="k">if</span> <span class="n">refined_info_start</span> <span class="o">!=</span> <span class="n">cur_start</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">&lt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span> <span class="o">-</span> <span class="mi">2000</span>
                <span class="c1"># hues.warn(&quot;ERROR-info-2, stop &lt; start!&quot;)</span>

            <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="c1"># hues.info(&quot;#CandidateCOs-2: &quot; + str(cur_start) + &quot;, &quot; + str(cur_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="c1"># hues.info(&quot;#RefinedInfoCOs-2: &quot; + str(refined_info_start) + &quot;, &quot; + str(refined_info_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="n">RefinedCOs</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">refined_info_start</span><span class="p">,</span> <span class="n">refined_info_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">):</span>

            <span class="n">pre_geno1</span><span class="p">,</span> <span class="n">pre_geno2</span> <span class="o">=</span> <span class="n">pre_geno</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">pre_geno1</span> <span class="o">==</span> <span class="n">cur_geno</span><span class="p">:</span>
                <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno1</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="n">pre_geno1</span>

            <span class="n">refined_infosnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_infosnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">refined_infosnp_pos</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Offspring_infoSNPs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">snp_geno</span> <span class="o">=</span> <span class="n">Offspring_infoSNPs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pre_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">cur_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span>
            <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">refined_infosnp_cnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

                <span class="n">snp_pos</span><span class="p">,</span> <span class="n">snp_type</span> <span class="o">=</span> <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&gt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                    <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">snp_pos</span>

                    <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">!=</span> <span class="n">cur_stop</span><span class="p">:</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&lt;</span> <span class="n">refined_info_stop</span><span class="p">:</span>
                    <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">snp_pos</span>

            <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">&lt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span> <span class="o">+</span> <span class="mi">2000</span>
                <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ERROR-info-3, stop &lt; start!&quot;</span><span class="p">)</span>

            <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="c1"># hues.info(&quot;#CandidateCOs-3: &quot; + str(cur_start) + &quot;, &quot; + str(cur_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="c1"># hues.info(&quot;#RefinedInfoCOs-3: &quot; + str(refined_info_start) + &quot;, &quot; + str(refined_info_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="n">RefinedCOs</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">refined_info_start</span><span class="p">,</span> <span class="n">refined_info_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno</span>
            <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="n">refined_infosnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_infosnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">refined_infosnp_pos</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_totalsnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_totalsnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Offspring_infoSNPs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">snp_geno</span> <span class="o">=</span> <span class="n">Offspring_infoSNPs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pre_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">cur_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span>
            <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">refined_infosnp_cnt</span><span class="p">):</span>

                <span class="n">snp_pos</span><span class="p">,</span> <span class="n">snp_type</span> <span class="o">=</span> <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&gt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                    <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">snp_pos</span>

                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&lt;</span> <span class="n">refined_info_stop</span><span class="p">:</span>
                    <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">snp_pos</span>

                    <span class="k">if</span> <span class="n">refined_info_start</span> <span class="o">!=</span> <span class="n">cur_start</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">&lt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                <span class="n">refined_info_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ERROR-info-4, stop &lt; start!&quot;</span><span class="p">)</span>

            <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;#CandidateCOs-4: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_start</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_stop</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">pre_geno</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">cur_geno</span><span class="p">)</span>
            <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;#RefinedInfoCOs-4: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">refined_info_start</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">refined_info_stop</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">pre_geno</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">cur_geno</span><span class="p">)</span>
            <span class="n">RefinedCOs</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">refined_info_start</span><span class="p">,</span> <span class="n">refined_info_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Re-refined crossovers&quot;</span><span class="p">)</span>
    <span class="n">Re_RefinedCOs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cur_item</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">co_key</span><span class="p">,</span> <span class="n">co_value</span> <span class="ow">in</span> <span class="n">RefinedCOs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">co_chr</span><span class="p">,</span> <span class="n">co_pos</span> <span class="o">=</span> <span class="n">co_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">co_geno1</span><span class="p">,</span> <span class="n">co_geno2</span> <span class="o">=</span> <span class="n">co_value</span>

        <span class="k">if</span> <span class="n">co_chr</span> <span class="o">!=</span> <span class="n">pre_co_chr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pre_co_chr</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>

            <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
            <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">)</span>
            <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_start</span><span class="p">)</span>
            <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_stop</span><span class="p">)</span>
            <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">co_geno1</span>
            <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">co_start</span> <span class="o">&lt;=</span> <span class="n">pre_co_stop</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">pre_co_geno2</span> <span class="o">==</span> <span class="n">co_geno1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">pre_co_geno1</span> <span class="o">==</span> <span class="n">co_geno2</span><span class="p">:</span>
                        <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
                        <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">pre_co_pos</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_co_start</span><span class="p">)</span>
                        <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_stop</span><span class="p">)</span>
                        <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">pre_co_geno1</span>
                        <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>
                        <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hues</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;#3#&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Diff GENO!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">co_start</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pre_co_geno1</span> <span class="ow">in</span> <span class="n">co_geno1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pre_co_geno2</span> <span class="ow">in</span> <span class="n">co_geno1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pre_co_geno2</span> <span class="o">==</span> <span class="n">co_geno2</span><span class="p">):</span>
                    <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
                    <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">pre_co_pos</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_co_start</span><span class="p">)</span>
                    <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_co_stop</span><span class="p">)</span>
                    <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">pre_co_geno1</span>
                    <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>
                    <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>
                    <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
                    <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_start</span><span class="p">)</span>
                    <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_stop</span><span class="p">)</span>
                    <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">co_geno1</span>
                    <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>

        <span class="n">cur_item</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cur_item</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">RefinedCOs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Re_RefinedCOs</span>
</pre></div>
</div>
<p><strong>Explication :</strong></p>
<dl>
<dt><cite>RefineCOBorders</cite><span class="classifier">Cette fonction <cite>RefineCOBorders</cite> affine les bords des croisements génétiques détectés précédemment. Cette fonction prend trois paramètres en entrée</span><span class="classifier"><cite>CandidateCOs</cite>, <cite>Offspring_infoSNPs</cite>, et <cite>window_size</cite>.</span></dt><dd><ul class="simple">
<li><p><cite>CandidateCOs</cite>: Un dictionnaire ordonné contenant les candidats aux croisements. Chaque élément du dictionnaire est une paire clé-valeur, où la clé est une chaîne de caractères représentant le chromosome et la position, et la valeur est une liste contenant les détails du candidat au croisement.</p></li>
<li><p><cite>Offspring_infoSNPs</cite>: Un dictionnaire contenant des informations sur les SNP (Single Nucleotide Polymorphisms) des descendants.</p></li>
<li><p><cite>window_size</cite>: La taille de la fenêtre utilisée dans l’analyse.</p></li>
</ul>
<p>La fonction commence par initialiser un dictionnaire vide appelé <cite>RefinedCOs</cite> pour stocker les croisements raffinés.</p>
<dl class="simple">
<dt>Ensuite, elle parcourt chaque candidat au croisement dans <cite>CandidateCOs</cite> et effectue les opérations suivantes :</dt><dd><ul class="simple">
<li><p>Extrayez les détails du candidat au croisement.</p></li>
<li><p>Ajustez les positions de début et de fin du croisement en fonction de la taille de la fenêtre.</p></li>
<li><dl class="simple">
<dt>Pour chaque SNP entre les positions de début et de fin du croisement :</dt><dd><ul>
<li><p>Si le génotype correspond au génotype précédent (avant le croisement), enregistrez la position du SNP.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Déterminez les nouvelles positions de début et de fin du croisement en fonction des SNP trouvés.</p></li>
<li><p>Enregistrez le croisement raffiné dans le dictionnaire <cite>RefinedCOs</cite>.</p></li>
</ul>
</dd>
</dl>
<p>La fonction renvoie ensuite le dictionnaire <cite>RefinedCOs</cite> contenant les croisements raffinés.</p>
</dd>
</dl>
</section>
<section id="function-identifycosqichao">
<h2>Function : IdentifyCOsQichao<a class="headerlink" href="#function-identifycosqichao" title="Link to this heading">#</a></h2>
<p><strong>Code :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">IdentifyCOsQichao</span><span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">,</span> <span class="n">Offspring_smoothWinNums</span><span class="p">,</span> \
                    <span class="n">Offspring_slidingGenoNums</span><span class="p">,</span> <span class="n">Offspring_slidingGenoRatios</span><span class="p">,</span> \
                    <span class="n">Centromere</span><span class="p">,</span> <span class="n">genoRef</span><span class="p">,</span> <span class="n">genoAlt</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Identify candidate crossovers&quot;</span><span class="p">)</span>

    <span class="n">CandidateCOs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="n">window</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">for</span> <span class="n">cur_chr</span><span class="p">,</span> <span class="n">win_num</span> <span class="ow">in</span> <span class="n">Offspring_smoothWinNums</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">min_win_num</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">max_win_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">win_num</span><span class="p">)</span>

        <span class="n">cur_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">cur_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">pre_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pre_num</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">cur1_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">cur1_pos1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur1_pos2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur1_num</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_win_num</span><span class="p">):</span>

            <span class="n">start</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">window</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># start+1!</span>

            <span class="k">if</span> <span class="n">stop</span> <span class="o">&gt;</span> <span class="n">win_num</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">win_num</span>

            <span class="k">if</span> <span class="n">stop</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">win_num</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">min_win_num</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_win_num</span> <span class="o">=</span> <span class="mi">5</span>

            <span class="n">key1</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">geno1</span> <span class="o">=</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">key2</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="n">geno2</span> <span class="o">=</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">key2</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">geno1</span> <span class="o">==</span> <span class="n">geno2</span><span class="p">:</span> <span class="c1">#geno</span>
                <span class="k">if</span> <span class="n">geno1</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">or</span> <span class="n">geno2</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span> <span class="c1"># should not happen ?</span>
                    <span class="k">continue</span>

                <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">geno2</span>
                <span class="n">cur_pos</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">cur_num</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="c1"># pre_geno only defined when geno1!=geno2 and cur_num &gt; (min_win_num - 1)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">or</span> <span class="n">cur_geno</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span> <span class="c1"># pre_geno only defined when geno1!=geno2 and cur_num &gt; (min_win_num - 1)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># when a change in genotype is finally detected between geno1</span>
                        <span class="k">if</span> <span class="n">cur_num</span> <span class="o">&lt;</span> <span class="n">min_win_num</span> <span class="ow">or</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">cur_geno</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">cur_num</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">):</span>
                                <span class="n">cur1_geno</span> <span class="o">=</span> <span class="n">cur_geno</span>
                                <span class="n">cur1_pos1</span> <span class="o">=</span> <span class="n">cur_pos</span> <span class="o">-</span> <span class="n">cur_num</span> <span class="o">+</span> <span class="mi">1</span>
                                <span class="n">cur1_pos2</span> <span class="o">=</span> <span class="n">cur_pos</span>
                                <span class="n">cur1_num</span> <span class="o">=</span> <span class="n">cur_num</span>
                            <span class="k">if</span> <span class="n">cur1_geno</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">cur_geno</span> <span class="ow">and</span> <span class="n">cur_num</span> <span class="o">&gt;=</span> <span class="n">min_win_num</span><span class="p">:</span>
                                <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Close double COs! -- same homo&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">continue</span>

                        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cur1_geno</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="c1"># hues.warn(&quot;Close double COs!&quot;)</span>

                            <span class="k">if</span> <span class="n">cur1_pos1</span> <span class="o">&lt;</span> <span class="n">pre_pos</span> <span class="ow">or</span> <span class="n">cur1_pos2</span> <span class="o">&gt;</span> <span class="n">cur_pos</span><span class="p">:</span>
                                <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">cur1_num</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">!=</span> <span class="n">cur_geno</span><span class="p">:</span>
                                        <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                        <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                        <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_pos</span> <span class="o">+</span> <span class="n">cur1_pos1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="p">:</span>
                                            <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur1_geno</span><span class="p">]</span>

                                        <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos2</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                        <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                        <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">cur1_pos2</span> <span class="o">+</span> <span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="p">:</span>
                                            <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">cur1_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                        <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span> <span class="c1"># cur1_num = 4</span>
                                    <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                    <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                    <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_pos</span> <span class="o">+</span> <span class="n">cur1_pos1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="p">:</span>
                                        <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur1_geno</span><span class="p">]</span>

                                    <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur1_pos2</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                    <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                                    <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">cur1_pos2</span> <span class="o">+</span> <span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="p">:</span>
                                        <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">cur1_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

                            <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="n">pre_pos</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">pre_num</span> <span class="o">=</span> <span class="mi">0</span>

                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                            <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_smoothProbs</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="n">min_win_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>

                        <span class="n">cur1_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


                        <span class="k">if</span> <span class="n">co_stop</span> <span class="o">-</span> <span class="n">co_start</span> <span class="o">&gt;</span> <span class="mi">300000</span><span class="p">:</span>
                            <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;large breakpoint interval, correct it!&quot;</span><span class="p">)</span>

                            <span class="n">cor_pre_pos</span> <span class="o">=</span> <span class="n">pre_pos</span> <span class="o">-</span> <span class="mi">10</span>
                            <span class="k">if</span> <span class="n">cor_pre_pos</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">cor_pre_pos</span> <span class="o">=</span> <span class="mi">1</span>

                            <span class="n">cor_cur_pos</span> <span class="o">=</span> <span class="n">cur_pos</span> <span class="o">+</span> <span class="mi">8</span>
                            <span class="k">if</span> <span class="n">cor_cur_pos</span> <span class="o">&gt;</span> <span class="n">win_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">cor_cur_pos</span> <span class="o">=</span> <span class="n">win_num</span> <span class="o">-</span> <span class="mi">1</span>

                            <span class="n">rawCO</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur_chr</span><span class="p">,</span> <span class="n">cor_pre_pos</span><span class="p">,</span> <span class="n">cor_cur_pos</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>
                            <span class="n">correctCO</span> <span class="o">=</span> <span class="n">CorrectLargeCOsQichao</span><span class="p">(</span><span class="n">Offspring_slidingGenoNums</span><span class="p">,</span>\
                                        <span class="n">Offspring_slidingGenoRatios</span><span class="p">,</span> <span class="n">rawCO</span><span class="p">,</span> <span class="n">Centromere</span><span class="p">,</span> <span class="n">genoRef</span><span class="p">,</span> <span class="n">genoAlt</span><span class="p">)</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">correctCO</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">correctCO</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_pos</span> <span class="o">+</span> <span class="n">cur_pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                                <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_pos</span> <span class="o">+</span> <span class="n">cur_pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                            <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

                        <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_pos</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">pre_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cur_num</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">min_win_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">pre_geno</span> <span class="o">=</span> <span class="n">geno1</span>
                    <span class="n">pre_pos</span> <span class="o">=</span> <span class="n">start</span>
                    <span class="n">pre_num</span> <span class="o">=</span> <span class="n">cur_num</span>
                <span class="n">cur_num</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">CandidateCOs</span>
</pre></div>
</div>
<p><strong>Explication :</strong></p>
<p><cite>IdentifyCOsQichao</cite>: Cette fonction identifie les croisements candidats à partir des données de probabilité lissée des génotypes des descendants.</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Entrée :</dt><dd><ul>
<li><p><cite>Offspring_smoothProbs</cite>: Dictionnaire contenant les probabilités lissées des génotypes des descendants.</p></li>
<li><p><cite>Offspring_smoothWinNums</cite>: Dictionnaire contenant le nombre de fenêtres pour chaque chromosome des descendants.</p></li>
<li><p><cite>Offspring_slidingGenoNums</cite>: Dictionnaire contenant les numéros de génotypes glissants des descendants.</p></li>
<li><p><cite>Offspring_slidingGenoRatios</cite>: Dictionnaire contenant les ratios de génotypes glissants des descendants.</p></li>
<li><p><cite>Centromere</cite>: Dictionnaire contenant les emplacements des centromères.</p></li>
<li><p><cite>genoRef</cite>: Génotype de référence.</p></li>
<li><p><cite>genoAlt</cite>: Génotype alternatif.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Fonctionnement :</dt><dd><ul>
<li><p>La fonction commence par initialiser un dictionnaire vide appelé <cite>CandidateCOs</cite> pour stocker les croisements candidats.</p></li>
<li><p>Ensuite, elle parcourt chaque chromosome dans <cite>Offspring_smoothWinNums</cite>.</p></li>
<li><p>Pour chaque fenêtre dans le chromosome, elle regarde les génotypes lissés des points de début et de fin de la fenêtre.</p></li>
<li><p>Si les génotypes sont les mêmes, cela signifie qu’il n’y a pas de changement de génotype dans cette fenêtre. Elle met alors à jour les variables de génotype et de position actuelles et continue à compter.</p></li>
<li><p>Si un changement de génotype est détecté, elle vérifie plusieurs conditions et calcule les positions de début et de fin du croisement candidat.</p></li>
<li><p>Elle met à jour les variables de génotype et de position précédentes, puis enregistre le croisement candidat dans le dictionnaire <cite>CandidateCOs</cite>.</p></li>
<li><p>Si un intervalle de pause est trop grand, elle corrige les positions de début et de fin du croisement candidat à l’aide d’une fonction de correction <cite>CorrectLargeCOsQichao</cite>.</p></li>
<li><p>Enfin, la fonction renvoie le dictionnaire <cite>CandidateCOs</cite> contenant les croisements candidats identifiés.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Cette fonction semble identifier les points où il y a un changement dans les génotypes des descendants, ce qui peut indiquer des points de recombinaison.</p>
</div></blockquote>
</section>
<section id="function-correctlargecosqichao">
<h2>Function : CorrectLargeCOsQichao<a class="headerlink" href="#function-correctlargecosqichao" title="Link to this heading">#</a></h2>
<p><strong>Code :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CorrectLargeCOsQichao</span><span class="p">(</span><span class="n">Offspring_slidingGenoNums</span><span class="p">,</span> <span class="n">Offspring_slidingGenoRatios</span><span class="p">,</span> <span class="n">rawCO</span><span class="p">,</span> <span class="n">Centromere</span><span class="p">,</span> <span class="n">genoRef</span><span class="p">,</span><span class="n">genoAlt</span><span class="p">,</span> <span class="n">min_homo_freq</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Correct large crossovers (centromere regions)&quot;</span><span class="p">)</span>

    <span class="n">CandidateCOs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">CorrectedCO</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">cur_chr</span><span class="p">,</span> <span class="n">rawCO_start</span><span class="p">,</span> <span class="n">rawCO_stop</span><span class="p">,</span> <span class="n">rawCO_geno1</span><span class="p">,</span> <span class="n">rawCO_geno2</span> <span class="o">=</span> <span class="n">rawCO</span>

    <span class="n">cur_chr_centro_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Centromere</span><span class="p">[</span><span class="n">cur_chr</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">150</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">cur_chr_centro_right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Centromere</span><span class="p">[</span><span class="n">cur_chr</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">150</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="n">window</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">sliding</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">cur_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cur_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cur_num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pre_num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">pre_na_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_na_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pre_na_num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rawCO_start</span><span class="p">,</span> <span class="n">rawCO_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">window</span> <span class="c1"># x+2</span>

        <span class="n">key1</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="c1"># window = x</span>
        <span class="n">geno1</span> <span class="o">=</span>     <span class="n">GetGenoWindow</span><span class="p">(</span><span class="n">Offspring_slidingGenoNums</span><span class="p">[</span><span class="n">key1</span><span class="p">],</span> <span class="n">genoRef</span><span class="o">=</span><span class="n">genoRef</span><span class="p">,</span> <span class="n">genoAlt</span><span class="o">=</span><span class="n">genoAlt</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>

        <span class="n">key2</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># window = x +1</span>
        <span class="n">geno2</span> <span class="o">=</span> <span class="n">GetGenoWindow</span><span class="p">(</span><span class="n">Offspring_slidingGenoNums</span><span class="p">[</span><span class="n">key2</span><span class="p">],</span> <span class="n">genoRef</span><span class="o">=</span><span class="n">genoRef</span><span class="p">,</span> <span class="n">genoAlt</span><span class="o">=</span><span class="n">genoAlt</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">geno1</span> <span class="o">==</span> <span class="n">geno2</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">geno1</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span> <span class="c1"># or geno2 == &quot;NA&quot;:</span>
                <span class="k">continue</span>

            <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">geno2</span>
            <span class="n">cur_pos</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">cur_num</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">or</span> <span class="n">cur_geno</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cur_num</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">cur_geno</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">pre_na_geno</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="c1"># elif</span>
                        <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                        <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_na_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_na_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_pos</span> <span class="o">+</span> <span class="n">pre_na_pos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">pre_na_geno</span><span class="p">]</span>

                        <span class="n">pre_na_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_na_pos</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">pre_na_num</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_pos</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                        <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Offspring_slidingGenoRatios</span><span class="p">[</span><span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">pre_pos</span> <span class="o">+</span> <span class="n">cur_pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">CandidateCOs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

                    <span class="n">pre_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">pre_pos</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">pre_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cur_num</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">geno1</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                <span class="n">pre_geno</span> <span class="o">=</span> <span class="n">geno1</span>
                <span class="n">pre_pos</span> <span class="o">=</span> <span class="n">start</span>
                <span class="n">pre_num</span> <span class="o">=</span> <span class="n">cur_num</span>

            <span class="k">if</span> <span class="n">geno2</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">geno1</span> <span class="o">!=</span> <span class="n">pre_geno</span> <span class="ow">and</span> <span class="n">pre_geno</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">pre_na_geno</span> <span class="o">=</span> <span class="n">geno1</span>
                <span class="n">pre_na_pos</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="n">cur_num</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">pre_na_num</span> <span class="o">=</span> <span class="n">cur_num</span>

            <span class="k">if</span> <span class="n">pre_pos</span> <span class="o">&gt;</span> <span class="n">pre_na_pos</span><span class="p">:</span>
                <span class="n">pre_na_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">pre_na_pos</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pre_na_num</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">geno2</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">geno1</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">geno2</span> <span class="o">==</span> <span class="n">pre_geno</span><span class="p">:</span>
                <span class="n">cur_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_num</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">keepRight</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">rawCO_geno1</span><span class="p">:</span>
        <span class="n">keepRight</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">rawCO_geno2</span><span class="p">:</span>
        <span class="n">keepRight</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">needOneMore</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">co_key</span><span class="p">,</span> <span class="n">co_value</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># not created yet !!!</span>
        <span class="n">co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pre_geno</span> <span class="o">=</span> <span class="n">co_value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">co_value</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">rawCO_geno1</span> <span class="ow">and</span> <span class="n">cur_geno</span> <span class="o">==</span> <span class="n">rawCO_geno2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">co_stop</span> <span class="o">&lt;=</span> <span class="n">cur_chr_centro_left</span> <span class="ow">or</span> <span class="n">co_start</span> <span class="o">&gt;=</span> <span class="n">cur_chr_centro_right</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">CorrectedCO</span> <span class="ow">and</span> <span class="n">needOneMore</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">needOneMore</span><span class="p">:</span>
                    <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
                    <span class="n">needOneMore</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">CandidateCOs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">keepRight</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">needOneMore</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">CorrectedCO</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                    <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">CandidateCOs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">keepRight</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">needOneMore</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
        <span class="k">elif</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">rawCO_geno1</span> <span class="ow">and</span> <span class="n">cur_geno</span> <span class="o">!=</span> <span class="n">rawCO_geno2</span><span class="p">:</span>
            <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
        <span class="k">elif</span> <span class="n">pre_geno</span> <span class="o">!=</span> <span class="n">rawCO_geno1</span> <span class="ow">and</span> <span class="n">cur_geno</span> <span class="o">==</span> <span class="n">rawCO_geno2</span><span class="p">:</span>
            <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CandidateCOs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">rawCO_geno2</span> <span class="ow">and</span> <span class="n">cur_geno</span> <span class="o">==</span> <span class="n">rawCO_geno1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">co_stop</span> <span class="o">&lt;=</span> <span class="n">cur_chr_centro_left</span> <span class="ow">or</span> <span class="n">co_start</span> <span class="o">&gt;=</span> <span class="n">cur_chr_centro_right</span><span class="p">:</span>
                    <span class="n">CorrectedCO</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_value</span>
                    <span class="n">needOneMore</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

    <span class="k">return</span> <span class="n">CorrectedCO</span>
</pre></div>
</div>
<p><strong>Explication :</strong></p>
<dl>
<dt><cite>CorrectLargeCOsQichao</cite><span class="classifier">Cette fonction corrige les croisements candidats identifiés dans les régions centromériques. Voici un résumé de son fonctionnement :</span></dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Entrée :</dt><dd><ul>
<li><p><cite>Offspring_slidingGenoNums</cite>: Dictionnaire contenant les numéros de génotypes glissants des descendants.</p></li>
<li><p><cite>Offspring_slidingGenoRatios</cite>: Dictionnaire contenant les ratios de génotypes glissants des descendants.</p></li>
<li><p><cite>rawCO</cite>: Liste contenant les informations brutes sur le croisement candidat à corriger.</p></li>
<li><p><cite>Centromere</cite>: Dictionnaire contenant les emplacements des centromères.</p></li>
<li><p><cite>genoRef</cite>: Génotype de référence.</p></li>
<li><p><cite>genoAlt</cite>: Génotype alternatif.</p></li>
<li><p><cite>min_homo_freq</cite>: Fréquence minimale des homozygotes.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Fonctionnement :</dt><dd><ul>
<li><p>La fonction commence par initialiser un dictionnaire vide <cite>CandidateCOs</cite> pour stocker les croisements candidats corrigés.</p></li>
<li><p>Ensuite, elle obtient les informations brutes sur le croisement candidat à corriger.</p></li>
<li><p>Elle détermine les positions du centre centromérique pour le chromosome en cours.</p></li>
<li><p>La fonction parcourt chaque position dans la plage spécifiée par les positions de début et de fin du croisement candidat.</p></li>
<li><p>Pour chaque position, elle récupère les génotypes des positions adjacentes.</p></li>
<li><p>Si les génotypes adjacents sont identiques, elle met à jour les variables actuelles de génotype, position et nombre.</p></li>
<li><p>Si un changement de génotype est détecté, elle traite les cas spécifiques où il y a des génotypes “NA” ou un changement de génotype dans une région centromérique.</p></li>
<li><p>Elle stocke ensuite les croisements candidats corrigés dans le dictionnaire <cite>CorrectedCO</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Enfin, la fonction renvoie le dictionnaire <cite>CorrectedCO</cite> contenant les croisements candidats corrigés.</p>
</dd>
</dl>
</section>
<section id="function-refinecobordersqichao">
<h2>Function : RefineCOBordersQichao<a class="headerlink" href="#function-refinecobordersqichao" title="Link to this heading">#</a></h2>
<p><strong>Code :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">RefineCOBordersQichao</span><span class="p">(</span><span class="n">CandidateCOs</span><span class="p">,</span> <span class="n">Offspring_infoSNPs</span><span class="p">,</span> <span class="n">window_size</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Refine crossover borders&quot;</span><span class="p">)</span>

    <span class="n">RefinedCOs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">co_key</span><span class="p">,</span> <span class="n">co_value</span> <span class="ow">in</span> <span class="n">CandidateCOs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">cur_chr</span><span class="p">,</span> <span class="n">cur_pos</span> <span class="o">=</span> <span class="n">co_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span> <span class="o">=</span> <span class="n">co_value</span>

        <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">):</span>

            <span class="n">cur_geno1</span><span class="p">,</span> <span class="n">cur_geno2</span> <span class="o">=</span> <span class="n">cur_geno</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno</span>
            <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">pre_geno</span> <span class="o">==</span> <span class="n">cur_geno1</span><span class="p">:</span>
                <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno1</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="n">pre_geno</span>

            <span class="n">refined_infosnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_infosnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">refined_infosnp_pos</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Offspring_infoSNPs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">snp_geno</span> <span class="o">=</span> <span class="n">Offspring_infoSNPs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pre_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">cur_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span>
            <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">refined_infosnp_cnt</span><span class="p">):</span>

                <span class="n">snp_pos</span><span class="p">,</span> <span class="n">snp_type</span> <span class="o">=</span> <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&gt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                    <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">snp_pos</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&lt;</span> <span class="n">refined_info_stop</span><span class="p">:</span>
                    <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">snp_pos</span>
                    <span class="k">if</span> <span class="n">refined_info_start</span> <span class="o">!=</span> <span class="n">cur_start</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">&lt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span> <span class="o">-</span> <span class="mi">2000</span>
                <span class="c1"># hues.warn(&quot;ERROR-info-2, stop &lt; start!&quot;)</span>

            <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="c1"># hues.info(&quot;#CandidateCOs-2: &quot; + str(cur_start) + &quot;, &quot; + str(cur_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="c1"># hues.info(&quot;#RefinedInfoCOs-2: &quot; + str(refined_info_start) + &quot;, &quot; + str(refined_info_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="n">RefinedCOs</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">refined_info_start</span><span class="p">,</span> <span class="n">refined_info_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">pre_geno</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cur_geno</span><span class="p">):</span>

            <span class="n">pre_geno1</span><span class="p">,</span> <span class="n">pre_geno2</span> <span class="o">=</span> <span class="n">pre_geno</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">pre_geno1</span> <span class="o">==</span> <span class="n">cur_geno</span><span class="p">:</span>
                <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno1</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="n">pre_geno1</span>

            <span class="n">refined_infosnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_infosnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">refined_infosnp_pos</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Offspring_infoSNPs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">snp_geno</span> <span class="o">=</span> <span class="n">Offspring_infoSNPs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pre_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">cur_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span>
            <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">refined_infosnp_cnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

                <span class="n">snp_pos</span><span class="p">,</span> <span class="n">snp_type</span> <span class="o">=</span> <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&gt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                    <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">snp_pos</span>

                    <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">!=</span> <span class="n">cur_stop</span><span class="p">:</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&lt;</span> <span class="n">refined_info_stop</span><span class="p">:</span>
                    <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">snp_pos</span>

            <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">&lt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span> <span class="o">+</span> <span class="mi">2000</span>
                <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ERROR-info-3, stop &lt; start!&quot;</span><span class="p">)</span>

            <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="c1"># hues.info(&quot;#CandidateCOs-3: &quot; + str(cur_start) + &quot;, &quot; + str(cur_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="c1"># hues.info(&quot;#RefinedInfoCOs-3: &quot; + str(refined_info_start) + &quot;, &quot; + str(refined_info_stop) + &quot;, &quot; + pre_geno + &quot;, &quot; + cur_geno)</span>
            <span class="n">RefinedCOs</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">refined_info_start</span><span class="p">,</span> <span class="n">refined_info_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">pre_geno_3</span> <span class="o">=</span> <span class="n">pre_geno</span>
            <span class="n">cur_geno_3</span> <span class="o">=</span> <span class="n">cur_geno</span>
            <span class="n">comm_geno</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="n">refined_infosnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_infosnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">refined_infosnp_pos</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_totalsnp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">refined_totalsnp_cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cur_start</span><span class="p">,</span> <span class="n">cur_stop</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">cur_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Offspring_infoSNPs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">snp_geno</span> <span class="o">=</span> <span class="n">Offspring_infoSNPs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pre_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">cur_geno_3</span> <span class="o">==</span> <span class="n">snp_geno</span><span class="p">:</span>
                        <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">refined_infosnp_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">refined_infosnp_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">refined_infosnp_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">cur_start</span>
            <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">cur_stop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">refined_infosnp_cnt</span><span class="p">):</span>

                <span class="n">snp_pos</span><span class="p">,</span> <span class="n">snp_type</span> <span class="o">=</span> <span class="n">refined_infosnp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&gt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                    <span class="n">refined_info_start</span> <span class="o">=</span> <span class="n">snp_pos</span>

                <span class="k">if</span> <span class="n">snp_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">snp_pos</span> <span class="o">&lt;</span> <span class="n">refined_info_stop</span><span class="p">:</span>
                    <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="n">snp_pos</span>

                    <span class="k">if</span> <span class="n">refined_info_start</span> <span class="o">!=</span> <span class="n">cur_start</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="n">refined_info_stop</span> <span class="o">&lt;</span> <span class="n">refined_info_start</span><span class="p">:</span>
                <span class="n">refined_info_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="n">refined_info_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="n">hues</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ERROR-info-4, stop &lt; start!&quot;</span><span class="p">)</span>

            <span class="n">cur_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_start</span> <span class="o">+</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">cur_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_stop</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;#CandidateCOs-4: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_start</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur_stop</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">pre_geno</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">cur_geno</span><span class="p">)</span>
            <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;#RefinedInfoCOs-4: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">refined_info_start</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">refined_info_stop</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">pre_geno</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">cur_geno</span><span class="p">)</span>
            <span class="n">RefinedCOs</span><span class="p">[</span><span class="n">co_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">refined_info_start</span><span class="p">,</span> <span class="n">refined_info_stop</span><span class="p">,</span> <span class="n">pre_geno</span><span class="p">,</span> <span class="n">cur_geno</span><span class="p">]</span>

    <span class="n">hues</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Re-refined crossovers&quot;</span><span class="p">)</span>
    <span class="n">Re_RefinedCOs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cur_item</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">co_key</span><span class="p">,</span> <span class="n">co_value</span> <span class="ow">in</span> <span class="n">RefinedCOs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">co_chr</span><span class="p">,</span> <span class="n">co_pos</span> <span class="o">=</span> <span class="n">co_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">co_start</span><span class="p">,</span> <span class="n">co_stop</span><span class="p">,</span> <span class="n">co_geno1</span><span class="p">,</span> <span class="n">co_geno2</span> <span class="o">=</span> <span class="n">co_value</span>

        <span class="k">if</span> <span class="n">co_chr</span> <span class="o">!=</span> <span class="n">pre_co_chr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pre_co_chr</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>

            <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
            <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">)</span>
            <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_start</span><span class="p">)</span>
            <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_stop</span><span class="p">)</span>
            <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">co_geno1</span>
            <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">co_start</span> <span class="o">&lt;=</span> <span class="n">pre_co_stop</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">pre_co_geno2</span> <span class="o">==</span> <span class="n">co_geno1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">pre_co_geno1</span> <span class="o">==</span> <span class="n">co_geno2</span><span class="p">:</span>
                        <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
                        <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">pre_co_pos</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_co_start</span><span class="p">)</span>
                        <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_stop</span><span class="p">)</span>
                        <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">pre_co_geno1</span>
                        <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>
                        <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hues</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;#3#&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Diff GENO!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">co_start</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pre_co_geno1</span> <span class="ow">in</span> <span class="n">co_geno1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pre_co_geno2</span> <span class="ow">in</span> <span class="n">co_geno1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pre_co_geno2</span> <span class="o">==</span> <span class="n">co_geno2</span><span class="p">):</span>
                    <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
                    <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">pre_co_pos</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_co_start</span><span class="p">)</span>
                    <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_co_stop</span><span class="p">)</span>
                    <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">pre_co_geno1</span>
                    <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>
                    <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>
                    <span class="n">pre_co_chr</span> <span class="o">=</span> <span class="n">co_chr</span>
                    <span class="n">pre_co_pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">co_pos</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">pre_co_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_start</span><span class="p">)</span>
                    <span class="n">pre_co_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">co_stop</span><span class="p">)</span>
                    <span class="n">pre_co_geno1</span> <span class="o">=</span> <span class="n">co_geno1</span>
                    <span class="n">pre_co_geno2</span> <span class="o">=</span> <span class="n">co_geno2</span>

        <span class="n">cur_item</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cur_item</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">RefinedCOs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Re_RefinedCOs</span><span class="p">[</span><span class="n">pre_co_chr</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_co_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_co_start</span><span class="p">,</span> <span class="n">pre_co_stop</span><span class="p">,</span> <span class="n">pre_co_geno1</span><span class="p">,</span> <span class="n">pre_co_geno2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Re_RefinedCOs</span>
</pre></div>
</div>
<p><strong>Explication :</strong></p>
<dl>
<dt><cite>RefineCOBordersQichao</cite><span class="classifier">Cette fonction affine les bordures des croisements candidats en utilisant des informations supplémentaires provenant des SNP.</span></dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Entrée :</dt><dd><ul>
<li><p><cite>CandidateCOs</cite> : Dictionnaire contenant les croisements candidats à affiner.</p></li>
<li><p><cite>Offspring_infoSNPs</cite> : Dictionnaire contenant des informations sur les SNP des descendants.</p></li>
<li><p><cite>window_size</cite> : Taille de la fenêtre utilisée pour affiner les croisements.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Fonctionnement :</dt><dd><ul>
<li><p>La fonction commence par initialiser un dictionnaire vide <cite>RefinedCOs</cite> pour stocker les croisements candidats affinés.</p></li>
<li><p>Ensuite, elle parcourt chaque croisement candidat du dictionnaire <cite>CandidateCOs</cite>.</p></li>
<li><p>Pour chaque croisement, elle extrait les informations nécessaires telles que le chromosome, la position de début et de fin, ainsi que les génotypes avant et après le croisement.</p></li>
<li><dl class="simple">
<dt>En fonction des génotypes avant et après le croisement, elle traite trois cas différents :</dt><dd><ol class="arabic simple">
<li><p>Si le génotype avant est homozgyote et le génotype après est hétérozygote, elle recherche les SNP qui correspondent au génotype avant et les utilise pour raffiner les positions de début et de fin du croisement.</p></li>
<li><p>Si le génotype avant est hétérozygote et le génotype après est homozgyote, elle recherche les SNP qui correspondent au génotype après et les utilise pour raffiner les positions de début et de fin du croisement.</p></li>
<li><p>Si les génotypes avant et après sont hétérozygotes, elle recherche les SNP correspondants à ces deux génotypes et les utilise pour raffiner les positions de début et de fin du croisement.</p></li>
</ol>
</dd>
</dl>
</li>
<li><p>Enfin, elle enregistre les croisements candidats affinés dans le dictionnaire <cite>RefinedCOs</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Après avoir raffiné les croisements candidats, la fonction passe à l’étape de “re-raffinement”. Elle parcourt chaque croisement affiné dans <cite>RefinedCOs</cite> et fusionne les croisements adjacents sur le même chromosome s’ils se chevauchent ou sont très proches. Elle prend également en compte les génotypes pour fusionner les croisements correctement.</p>
<p>Enfin, elle renvoie le dictionnaire <cite>Re_RefinedCOs</cite> contenant les croisements candidats affinés et fusionnés.</p>
</dd>
</dl>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="test_detectCOs_polyrec_functions.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">test_detectCOs_polyrec_functions.py</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="detectCOs_sliding_window.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">detectCOs_sliding_window.py</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Mohamad Yassine
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">detectCOs_identifyCOs.py</a><ul>
<li><a class="reference internal" href="#function-identifycos">Function : IdentifyCOs</a></li>
<li><a class="reference internal" href="#function-refinecoborders">Function : RefineCOBorders</a></li>
<li><a class="reference internal" href="#function-identifycosqichao">Function : IdentifyCOsQichao</a></li>
<li><a class="reference internal" href="#function-correctlargecosqichao">Function : CorrectLargeCOsQichao</a></li>
<li><a class="reference internal" href="#function-refinecobordersqichao">Function : RefineCOBordersQichao</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=60dbed4a"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>